pipeline {

    agent any
    tools {
        maven 'apache-maven-3.6.3' 
    }
    stages {
        stage('Compile stage') {
            steps {
                bat "mvn compile verify sonar:sonar" 
        }
    }

         stage('testing stage') {
             steps {
                bat "mvn test verify sonar:sonar"
        }
    }
    stage('artifactory') {
    steps{
    
    rtServer (
    id: 'art-1',
    url: 'http://my-artifactory-domain/artifactory',
    // If you're using username and password:
    username: 'admin',
    password: 'wordjfrog')
                 rtMavenDeployer (
                    id: "MAVEN_DEPLOYER",
                    serverId: "art-1",
                    releaseRepo: "libs-release-local",
                    snapshotRepo: "libs-snapshot-local"
                )

                rtMavenResolver (
                    id: "MAVEN_RESOLVER",
                    serverId: "art-1",
                    releaseRepo: "libs-release",
                    snapshotRepo: "libs-snapshot"
                )
                rtMavenResolver (
                    id: "MAVEN_RESOLVER",
                    serverId: "ARTIFACTORY_SERVER",
                    releaseRepo: "libs-release",
                    snapshotRepo: "libs-snapshot"
                )
                
                 rtPublishBuildInfo (
                    serverId: "art-1"
                    )
    }
    }

          stage('deployment stage') {
              steps {
                bat "mvn tomcat7:run"
        }
    }
    }
    }
